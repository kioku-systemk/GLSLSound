<html>
    <head>
        <script src="glslsound.js"></script>
        <script>
        var soundShader = (function () {/*
  #define NSPC 256
#define pi2 6.283185307179586476925286766559

vec2 synth(float t)
{
	vec2 v = vec2(0.0);
	float base = 50.0 + sin(t * 0.1) * 20.0;
	float flt = cos(t * 1.0) * 6.0 + 10.0;
	float fmd = smoothstep(-0.1, 0.1, sin(t * 1.0)) * 100.0;
	for(int i = 0; i < NSPC; i ++)
	{
		float h = float(i + 1);
		float inten = 1.0 / h;
		inten *= sin((pow(h, sin(t) * 0.5 + 0.5) + t * 0.5) * pi2) * 0.9 + 0.1;
		vec2 ti = texture2D(iChannel0, vec2(h / 256.0, t * 0.1)).xy;
		float f = ti.y * fmd;
		inten *= pow(ti.x, 6.0);
		inten *= exp(-max(4.0 - h * 2.0, 0.0));
		inten *= mod(h, 2.0);
		v.x += inten * sin(h + pi2 * (t * base * h) + f);
		v.y += inten * sin(pi2 * (t * base * h) + f);
	}
	return v;
}

vec2 mainSound(float time)
{
	vec2 m;
	m = synth(time);
	float ec = 0.5, fb = 0.8, et = 0.3, tm = 0.3;
	m += synth(time - et) * ec * vec2(1.0, 0.2); ec *= fb; et += tm;
	m += synth(time - et).yx * ec * vec2(0.2, 1.0); ec *= fb; et += tm;
	m += synth(time - et) * ec * vec2(1.0, 0.2); ec *= fb; et += tm;
	m += synth(time - et).yx * ec * vec2(0.2, 1.0); ec *= fb; et += tm;
	m *= 8.8;
	return m;
}
        */}).toString().match(/\n([\s\S]*)\n/)[1];

        window.onload = function () {
            sound = new GLSLSound();
            sound.setGain(0.5);
            var cr = sound.compleShader(soundShader);
            if (!cr) {
                var msg = document.createTextNode('Compile failed:' + sound.getError());
                document.body.appendChild(msg);
            } else { 
                sound.prepare(5.0); // 5.0[sec] sound
                
                var button = document.createElement('button');
                document.body.appendChild(button);
                button.innerHTML = "play GLSL";
                button.addEventListener('click', function () {
                    sound.play();
                });
            }
        }
        </script>
    </head>
<body>
</body>
</html>